<!--

/*********************************************************************************

 * The contents of this file are subject to the SugarCRM Public License Version 1.1.2

 * ("License"); You may not use this file except in compliance with the

 * License. You may obtain a copy of the License at http://www.sugarcrm.com/SPL

 * Software distributed under the License is distributed on an  "AS IS"  basis,

 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for

 * the specific language governing rights and limitations under the License.

 * The Original Code is:  SugarCRM Open Source

 * The Initial Developer of the Original Code is SugarCRM, Inc.

 * Portions created by SugarCRM are Copyright (C) SugarCRM, Inc.;

 * All Rights Reserved.

 * Contributor(s): ______________________________________.

 ********************************************************************************/

/*********************************************************************************

 * {APP.LBL_CURRENCY_SYM}Header: /cvsroot/sugarcrm/sugarcrm/modules/Accounts/EditView.html,v 1.16 2004/07/16 00:42:57 sugarclint Exp {APP.LBL_CURRENCY_SYM}

 ********************************************************************************/

-->

<!-- BEGIN: main -->

<form name="EditView" method="POST" action="index.php">
<table width="100%" cellpadding="2" cellspacing="0" border="0">

<tr>

    <td vAlign="middle" align="left"><IMG src="{IMAGE_PATH}Accounts.gif" border="0"></td>

    <td class="moduleTitle" vAlign="middle" align="left" noWrap width="100%" height="20">{MOD.LBL_SO}  {NAME}</td>

	<td nowrap class='bodySmall' align='right'>[ <A href='http://www.vtiger.com/products/crm/document.html' target='_blank'>{APP.LNK_HELP}</A> ]</td>

</tr>

<tr><td colspan="3" class="hline"><img height='1' src='include/images/blank.gif'></td></tr></table>


<br>
<table width="100%" cellpadding="0" cellspacing="0" border="0"><tr>
	<td>
<div align="center">
		
	       <link rel="stylesheet" type="text/css" media="all" href="jscalendar/calendar-win2k-cold-1.css">

	       <script type="text/javascript" src="jscalendar/calendar.js"></script>

               <script type="text/javascript" src="jscalendar/lang/calendar-{CALENDAR_LANG}.js"></script>

		<script type="text/javascript" src="jscalendar/calendar-setup.js"></script>


			<input type="hidden" name="module" value="Orders">

			<input type="hidden" name="record" value="{ID}">

			<input type="hidden" name="mode" value="{MODE}">

			<input type="hidden" name="action">

			<input type="hidden" name="return_module" value="{RETURN_MODULE}">

			<input type="hidden" name="return_id" value="{RETURN_ID}">

			<input type="hidden" name="return_action" value="{RETURN_ACTION}">

			<input type="hidden" name="totalProductCount">

		<input title="{APP.LBL_SAVE_BUTTON_TITLE}" accessKey="{APP.LBL_SAVE_BUTTON_KEY}" class="button" onclick="this.form.action.value='SaveSalesOrder';settotalnoofrows(); return formValidate() " type="submit" name="button" value="  {APP.LBL_SAVE_BUTTON_LABEL}  " >

		<input title="{APP.LBL_CANCEL_BUTTON_TITLE}" accessKey="{APP.LBL_CANCEL_BUTTON_KEY}" class="button" onclick="window.history.back()" type="button" name="button" value="  {APP.LBL_CANCEL_BUTTON_LABEL}  ">

		
	</div>
</td>

</tr>

</table>


	<div align="right"><font class="required">{APP.LBL_REQUIRED_SYMBOL}</font>{APP.NTC_REQUIRED}</div>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="formOuterBorder">

<tr>

<td>

	{BLOCK1_HEADER}

	

	<table width="100%" border="0" cellspacing="1" cellpadding="0">		

	{BLOCK1}	

	</table>

</td></tr></table>

<BR>

        {CUSTOMFIELD}

<table width="100%" border="0" cellspacing="0" cellpadding="0" class="formOuterBorder">

<tr><td>

	{BLOCK2_HEADER}

	<table width="100%" border="0" cellspacing="1" cellpadding="0">		

	{BLOCK2}

	</table>

</td></tr></table>

<BR>

<table width="100%" border="0" cellspacing="0" cellpadding="0" class="formOuterBorder">
<tr><td>
	{BLOCK4_HEADER}
	<table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr> 
      <td class="dataLabel" width="20%" height="28">Product: </td>
	<td class="dataLabel" width="30%">
	<div align="left">
        <input name="txtProduct" type="text">
	<input title="Change [Alt+G]" accessKey="G" type="button" class="button" value="Select" name="button" LANGUAGE=javascript onclick='return window.open("index.php?module=Products&action=Popup&html=Popup_picker&form=HelpDeskEditView&popuptype=inventory_prod","test","width=600,height=400,resizable=1,scrollbars=1,top=150,left=200");'>
	</div>
	</td>
	<td class="dataLabel" width="20%">
        Product Qty: 
	</td>
	<td class="dataLabel" width="30%">
	<div align="left">
        <input name="txtQty" type="text" value="1" size="5"> <input type="button" class="button" value="add" onClick="addRow()"> 
        <input name="hdnUnitPrice" type="hidden" value="11.75"> <input name="hdnProductId" type="hidden"> 
	</div>
      </td>
    </tr>
  </table>
  <div id="productList">
   
    <table width="100%" border="0" cellspacing="1" cellpadding="0">
      <tr> 
        <td width="20%" class="dataLabel"><b><div align="left">Product</div></b></td>
        <td width="15%" class="dataLabel"><b><div align="left">Qty</b></div></td>
        <td width="20%" class="dataLabel"><b>Unit Price</b></td>
        <td width="20%" class="dataLabel"><b>List Price</b></td>
        <td width="20%" class="dataLabel"><b>Total</b></td>
        <td width="10" class="dataLabel"></td>
      </tr>
	{ASSOCIATEDPRODUCTS}
    </table>  </div>
  <table width="100%" border="0" cellspacing="2" cellpadding="2">
    <tr> 
      <td width="100%"><div align="right"><b>Sub Total:</b></div></td>
	  <td id="subTotal" align="right" width="100" style="border:1px solid #000;">{GRANDTOTAL}</td>
	  <td width="40">&nbsp;</td>
    </tr>
    <tr>
      <td><div align="right"><b>Tax:</b></div></td>
          <td align="right" width="100"><input type="text" id="txtTax" name="txtTax" value="{TAXVALUE}" onblur="calcGrandTotal()"></td>
          <td width="40">&nbsp;</td>
    </tr>
    <tr>
      <td><div align="right"><b>Grand Total:</b></div></td>
          <td id="grandTotal" align="right" width="100" style="border:1px solid #000;">{SUBTOTAL}</td>
          <td width="40">&nbsp;</td>
    </tr>
  </table>
  <div id="strikeLines">{STRIKELINES}</div>
<input type="hidden" name="hdnSubTotal" id="hdnSubTotal" value="{SUBTOTAL}">
<input type="hidden" name="hdnGrandTotal" id="hdnGrandTotal" value="{GRANDTOTAL}">
</td></tr></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="formOuterBorder">

<tr><td>

	{BLOCK3_HEADER}

	<table width="100%" border="0" cellspacing="1" cellpadding="0">		

	{BLOCK3}

	</table>

</td></tr></table>
<br>
 <table width="100%" cellpadding="0" cellspacing="0" border="0"><tr>


      <td><div align="center">
           <input title="{APP.LBL_SAVE_BUTTON_TITLE}" tabindex='5' accessKey="{APP.LBL_SAVE_BUTTON_KEY}" class="button" onclick="this.form.action.value='Save';settotalnoofrows();return formValidate()" type="submit" name="button" value="  {APP.LBL_SAVE_BUTTON_LABEL}  " >

		<input title="{APP.LBL_CANCEL_BUTTON_TITLE}" accessKey="{APP.LBL_CANCEL_BUTTON_KEY}" class="button" onclick="window.history.back()" type="button" name="button" value="  {APP.LBL_CANCEL_BUTTON_LABEL}  ">

         </div>
     </td>

 </tr></table>

</form>
<script type="text/javascript" language="JavaScript">
var prodList=getObj("productList")
var rowCnt={ROWCOUNT};
var listTableStart="<table width='100%' border='0' cellspacing='1' cellpadding='0' class='formOuterBorder'>"

function settotalnoofrows()
{
	document.EditView.totalProductCount.value = rowCnt;	
}

function addRow() {
	//Checking if the ProductId exists
	if(document.EditView.hdnProductId.value == '')
	{
		alert("Select a Product and then Add");
		return false;
	}	
	//adding new row
	rowCnt++;

	//calculating product total and truncating decimal part to digits
	var prodTotal=eval(getObj("txtQty").value*getObj("hdnUnitPrice").value).toString()
	prodTotal=roundValue(prodTotal)	
		
	var newRow="<tr id=row"+rowCnt+" class='evenListRow'><td align='left'>"+getObj("txtProduct").value+"</td>"
	newRow+="<td align='left'><input type=text id='txtQty"+rowCnt+"' name='txtQty"+rowCnt+"' size='5' value='"+getObj("txtQty").value+"' onBlur='calcTotal("+rowCnt+")'></td>"
	newRow+="<td class='dataLabel' align='left'>"+getObj("hdnUnitPrice").value+"</td>"

	newRow+="<td class='dataLabel'<input type=text id='txtListPrice"+rowCnt+"' name='txtListPrice"+rowCnt+"' size='12' value='"+getObj("hdnUnitPrice").value+"' onBlur='calcTotal("+rowCnt+")'><input title='Change [Alt+G]' accessKey='G' type='button' class='button' value='Select' name='button' LANGUAGE=javascript onclick=\"return window.open('index.php?module=Products&action=PriceBookPopup&html=Popup_picker&form=EditView&popuptype=inventory_pb&fldname=txtListPrice"+rowCnt+"&productid="+getObj("hdnProductId").value+"','test','width=600,height=400,resizable=1,scrollbars=1,top=150,left=200');\"></td>"

	newRow+="<td class='dataLabel'><div id='total"+rowCnt+"' align='right'>"+prodTotal+"</div></td>"
	newRow+="<td class='dataLabel' id='delCol"+rowCnt+"'><a href='javascript:delRow("+rowCnt+")'>Del</a>"
	newRow+="<input type=hidden id='hdnProductId"+rowCnt+"' name='hdnProductId"+rowCnt+"' value='"+getObj("hdnProductId").value+"'>"
	newRow+="<input type=hidden id='hdnRowStatus"+rowCnt+"' name='hdnRowStatus"+rowCnt+"'>"
	newRow+="<input type=hidden id='hdnTotal"+rowCnt+"' name='hdnTotal"+rowCnt+"'>"
	newRow+="</td></tr>"
	
	if (browser_ie) {
		var prodListBody=getObj("productList").children[0].children[0]
	} else if (browser_nn4 || browser_nn6) {
		if (getObj("productList").childNodes.item(0).tagName=="TABLE") {
                        var prodListBody=getObj("productList").childNodes.item(0).childNodes.item(0)
                } else {
                        var prodListBody=getObj("productList").childNodes.item(1).childNodes.item(1)
                }
	}
	
	prodList.innerHTML=listTableStart+prodListBody.innerHTML+newRow+"</table>"
	
	//creating strike lines that is to be displayed while deleting a row
	var lineLeft=findPosX(getObj("row"+rowCnt))
	var lineTop=findPosY(getObj("row"+rowCnt))
	var lineWidth=prodList.offsetWidth-getObj("delCol"+rowCnt).offsetWidth
	var strikeLine="<div id='strikeLine"+rowCnt+"' style='visibility:hidden;background:url({IMAGE_PATH}strikeline.gif) repeat-x;position:absolute;top:"+lineTop+";left:"+lineLeft+";width:"+lineWidth+";height:20px;z-index:10'></div>"

	getObj("strikeLines").innerHTML+=strikeLine
	
	calcGrandTotal()	
}

function delRow(rowId) {
	//striking a row
	if (getObj("strikeLine"+rowId).style.visibility=="hidden") {
		getObj("strikeLine"+rowId).style.visibility="visible"
		getObj("hdnRowStatus"+rowId).value="D"
	} else {
		getObj("strikeLine"+rowId).style.visibility="hidden"
		getObj("hdnRowStatus"+rowId).value="U"
	}
	
	calcGrandTotal()
}

function calcTotal(rowId) {
	getObj("total"+rowId).innerHTML=getObj("hdnTotal"+rowId).value=roundValue(eval(getObj("txtQty"+rowId).value*getObj("txtListPrice"+rowId).value).toString())
	calcGrandTotal()
}

function calcGrandTotal() {
	var subTotal=0,grandTotal=0;
	for (var i=1;i<=rowCnt;i++) {
		if (getObj("hdnRowStatus"+i).value!="D") {
			subTotal+=parseFloat(getObj("total"+i).innerHTML)
		}
	}

	grandTotal=subTotal+parseFloat(getObj("txtTax").value)
	getObj("subTotal").innerHTML=getObj("hdnSubTotal").value=roundValue(subTotal.toString())
	getObj("grandTotal").innerHTML=getObj("hdnGrandTotal").value=roundValue(grandTotal.toString())
}

function roundValue(val) {
	if (val.indexOf(".")<0) {
		val+=".00"
	} else {
		var dec=val.substring(val.indexOf(".")+1,val.length)
		if (dec.length>2)
			val=val.substring(0,val.indexOf("."))+"."+dec.substring(0,2)
		else if (dec.length==1)
			val=val+"0"
	}
	
	return val;
}

function createStrikeLines() {
	var lineLeft,lineTop,lineWidth,strikeLine="";
	for (var i=1;i<=rowCnt;i++) {
		lineLeft=findPosX(getObj("row"+i))
	       	lineTop=findPosY(getObj("row"+i))
        	lineWidth=prodList.offsetWidth-getObj("delCol"+i).offsetWidth

		strikeLine+="<div id='strikeLine"+i+"' style='visibility:hidden;background:url({IMAGE_PATH}strikeline.gif) repeat-x;position:absolute;top:"+lineTop+";left:"+lineLeft+";width:"+lineWidth+";height:20px;z-index:10'></div>"
	}

        getObj("strikeLines").innerHTML=strikeLine
}

createStrikeLines();
</script>


<script type="text/javascript" language="Javascript">

function copyAddressRight(form) {

	form.ship_street.value = form.bill_street.value;

	form.ship_city.value = form.bill_city.value;

	form.ship_state.value = form.bill_state.value;

	form.ship_code.value = form.bill_code.value;

	form.ship_country.value = form.bill_country.value;

	return true;

}

function copyAddressLeft(form) {

	form.bill_street.value = form.ship_street.value;

	form.bill_city.value = form.ship_city.value;

	form.bill_state.value = form.ship_state.value;

	form.bill_code.value =	form.ship_code.value;

	form.bill_country.value = form.ship_country.value;

	return true;

}

</script>

<script>

	

	var fieldname = new Array({VALIDATION_DATA_FIELDNAME})

	var fieldlabel = new Array({VALIDATION_DATA_FIELDLABEL})

	var fielddatatype = new Array({VALIDATION_DATA_FIELDDATATYPE})

</script>





{JAVASCRIPT}

<!-- END: main -->

